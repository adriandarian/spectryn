# ==============================================================================
# spectryn Docker Compose
# Example setup for containerized usage with environment configuration
# ==============================================================================
#
# Usage:
#   1. Copy .env.example to .env and fill in your Jira credentials
#   2. Place your markdown file in the current directory
#   3. Run: docker compose run --rm spectryn --markdown EPIC.md --epic PROJ-123
#
# ==============================================================================

services:
  spectryn:
    build:
      context: .
      dockerfile: Dockerfile
    image: spectryn:latest
    
    # Mount current directory as workspace for markdown files
    volumes:
      - .:/workspace:ro
      # Optional: persist backups between runs
      - spectryn-backups:/home/spectryn/.spectryn/backups
    
    # Load environment from .env file
    env_file:
      - .env
    
    # Override with explicit environment variables if needed
    environment:
      - JIRA_URL=${JIRA_URL:-}
      - JIRA_EMAIL=${JIRA_EMAIL:-}
      - JIRA_API_TOKEN=${JIRA_API_TOKEN:-}
    
    # Working directory inside container
    working_dir: /workspace

  # Convenience service for dry-run mode
  spectryn-dry-run:
    extends:
      service: spectryn
    # Default to showing help; override with your command
    command: ["--help"]

  # Convenience service for executing syncs
  spectryn-sync:
    extends:
      service: spectryn
    # Mount as read-write for backup/export operations
    volumes:
      - .:/workspace
      - spectryn-backups:/home/spectryn/.spectryn/backups
    command: ["--execute", "--no-confirm"]

volumes:
  spectryn-backups:
    name: spectryn-backups

